(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bb800f2c"],{5014:function(e,t,r){},"62c7":function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"choose-user-input"},[r("div",{staticClass:"choose-user-tags"},e._l(e.tags,function(t,a){return r("a-tag",{key:t.account,attrs:{closable:""},on:{close:function(t){return e.deleteTag(a)}}},[e._v(e._s(t.name))])}),1),r("a-button",{attrs:{type:"primary"},on:{click:function(t){e.visible=!0}}},[e._v("选择用户")]),r("a-modal",{staticStyle:{top:"20px"},attrs:{title:e.title,width:600},on:{ok:e.handleOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[r("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[r("a-transfer",{attrs:{dataSource:e.userList,showSearch:"",filterOption:e.filterOption,targetKeys:e.targetKeys,render:e.renderItem},on:{change:e.handleChange,selectChange:e.handleSelectChange}})],1)])],1)},n=[],i=(r("6762"),r("2fdb"),r("7f7f"),r("a745")),o=r.n(i);function s(e){if(o()(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}var l=r("774e"),c=r.n(l),u=r("c8bb"),d=r.n(u);function p(e){if(d()(Object(e))||"[object Arguments]"===Object.prototype.toString.call(e))return c()(e)}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function m(e){return s(e)||p(e)||f()}var v=r("365c"),h={props:{title:String,value:{type:Array,default:function(){return[]}},isSingle:{type:Boolean,default:function(){return!0}}},data:function(){return{userList:[],targetKeys:[],visible:!1,tags:[]}},watch:{value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.targetKeys=e},targetKeys:function(e,t){this.isSingle&&e.length>1&&(this.$message.error("只能指派一个用户"),e.pop())}},created:function(){this.getUsers()},methods:{deleteTag:function(e){this.tags.splice(e,1),this.triggerChange(this.tags)},handleChange:function(e,t,r){this.targetKeys=e},handleSelectChange:function(e,t){this.selectedKeys=[].concat(m(e),m(t))},getUsers:function(e){var t=this;v["default"].user.list({pageNo:1,pageSize:-1,keyword:e}).then(function(e){t.userList=e.result.data.map(function(e){return e.key=e.id,e.title=e.name,e.description=e.position,e.chosen=!1,e})})},show:function(e){this.title=e,this.visible=!0},renderItem:function(e){var t=this.$createElement,r=t("span",{class:"custom-item"},[e.name]);return{label:r,value:e.name}},close:function(){this.visible=!1},handleOk:function(){var e=this,t=this.userList.filter(function(t){return e.targetKeys.includes(t.id)});this.tags=t,this.close(),this.triggerChange(t)},filterOption:function(e,t){return t.name.indexOf(e)>-1},triggerChange:function(e){this.$emit("change",e)}}},g=h,b=(r("a34b"),r("2877")),y=Object(b["a"])(g,a,n,!1,null,null,null);t["a"]=y.exports},"62f6":function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a-modal",{staticStyle:{top:"20px"},attrs:{title:"新增"+e.typeText,width:800},on:{ok:e.handleOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[r("a-form",{attrs:{form:e.form,id:"userForm"}},[r("a-form-item",{attrs:{label:e.typeText+"名称",hasFeedback:""}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入"+e.typeText+"名称"}]}],expression:"[\n          'name',\n          {rules: [{ required: true, message: `请输入${typeText}名称` }]}\n        ]"}],attrs:{placeholder:""}})],1)],1)],1)},n=[],i=(r("7f7f"),r("365c")),o={data:function(){return{visible:!1,type:1,form:this.$form.createForm(this)}},computed:{typeText:function(){var e="";switch(this.type){case 1:e="项目";break;case 2:e="模块";break;case 3:e="版本";break}return e}},methods:{add:function(e){var t=this;this.visible=!0,this.type=e,this.$nextTick(function(){t.form.resetFields()})},close:function(){this.$emit("close"),this.visible=!1},handleOk:function(){var e=this;this.form.validateFields(function(t,r){t||(e.confirmLoading=!0,i["default"].system.addSystemClassfication(e.type,r.name).then(function(t){e.$message.success("保存成功"),e.$emit("ok",e.type,r.name)}).catch(function(){}).finally(function(){e.confirmLoading=!1,e.close()}))})}}},s=o,l=r("2877"),c=Object(l["a"])(s,a,n,!1,null,null,null);t["a"]=c.exports},"774e":function(e,t,r){e.exports=r("d2d5")},"88bc":function(e,t,r){(function(t){var r=1/0,a=9007199254740991,n="[object Arguments]",i="[object Function]",o="[object GeneratorFunction]",s="[object Symbol]",l="object"==typeof t&&t&&t.Object===Object&&t,c="object"==typeof self&&self&&self.Object===Object&&self,u=l||c||Function("return this")();function d(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function p(e,t){var r=-1,a=e?e.length:0,n=Array(a);while(++r<a)n[r]=t(e[r],r,e);return n}function f(e,t){var r=-1,a=t.length,n=e.length;while(++r<a)e[n+r]=t[r];return e}var m=Object.prototype,v=m.hasOwnProperty,h=m.toString,g=u.Symbol,b=m.propertyIsEnumerable,y=g?g.isConcatSpreadable:void 0,w=Math.max;function _(e,t,r,a,n){var i=-1,o=e.length;r||(r=k),n||(n=[]);while(++i<o){var s=e[i];t>0&&r(s)?t>1?_(s,t-1,r,a,n):f(n,s):a||(n[n.length]=s)}return n}function C(e,t){return e=Object(e),x(e,t,function(t,r){return r in e})}function x(e,t,r){var a=-1,n=t.length,i={};while(++a<n){var o=t[a],s=e[o];r(s,o)&&(i[o]=s)}return i}function S(e,t){return t=w(void 0===t?e.length-1:t,0),function(){var r=arguments,a=-1,n=w(r.length-t,0),i=Array(n);while(++a<n)i[a]=r[t+a];a=-1;var o=Array(t+1);while(++a<t)o[a]=r[a];return o[t]=i,d(e,this,o)}}function k(e){return j(e)||L(e)||!!(y&&e&&e[y])}function O(e){if("string"==typeof e||B(e))return e;var t=e+"";return"0"==t&&1/e==-r?"-0":t}function L(e){return N(e)&&v.call(e,"callee")&&(!b.call(e,"callee")||h.call(e)==n)}var j=Array.isArray;function A(e){return null!=e&&F(e.length)&&!q(e)}function N(e){return $(e)&&A(e)}function q(e){var t=V(e)?h.call(e):"";return t==i||t==o}function F(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=a}function V(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function $(e){return!!e&&"object"==typeof e}function B(e){return"symbol"==typeof e||$(e)&&h.call(e)==s}var E=S(function(e,t){return null==e?{}:C(e,p(_(t,1),O))});e.exports=E}).call(this,r("c8ba"))},"96c0":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("a-card",{attrs:{title:"编辑Bug"}},[r("a-form",{staticClass:"ant-advanced-search-form",attrs:{form:e.form},on:{submit:e.handleSubmit}},[r("a-row",{attrs:{gutter:24}},[r("a-col",{attrs:{span:24}},[r("a-row",[r("a-col",{attrs:{span:12}},[r("a-form-item",{attrs:{label:"Bug标题"}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,message:"请输入Bug标题"}]}],expression:"[\n                    `title`,\n                    {\n                      rules: [{\n                        required: true,\n                        message: '请输入Bug标题',\n                      }],\n                    }\n                  ]"}],attrs:{placeholder:""}})],1)],1),r("a-col",{attrs:{span:6}},[r("a-form-item",[r("a-input-group",{attrs:{compact:""}},[r("a-input",{staticStyle:{width:"40%","border-radius":"0","text-align":"center"},attrs:{defaultValue:"严重程度",disabled:""}}),r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["severity",{rules:[{required:!0,message:"请选择严重程度"}]}],expression:"[\n                      `severity`,\n                      {\n                        rules: [{\n                          required: true,\n                          message: '请选择严重程度',\n                        }],\n                      }\n                    ]"}],staticStyle:{width:"60%","border-left":"none","border-radius":"0"}},e._l(e.BUG_VARIABLES.severity,function(t,a){return r("a-select-option",{key:t,attrs:{value:a}},[e._v(e._s(t))])}),1)],1)],1)],1),r("a-col",{attrs:{span:6}},[r("a-form-item",[r("a-input-group",{attrs:{compact:""}},[r("a-input",{staticStyle:{width:"40%","border-radius":"0","text-align":"center"},attrs:{defaultValue:"优先级",disabled:""}}),r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["priority",{rules:[{required:!0,message:"请选择优先级"}]}],expression:"[\n                      `priority`,\n                      {\n                        rules: [{\n                          required: true,\n                          message: '请选择优先级',\n                        }],\n                      }\n                    ]"}],staticStyle:{width:"60%","border-left":"none","border-radius":"0"}},e._l(e.BUG_VARIABLES.priority,function(t,a){return r("a-select-option",{key:t,attrs:{value:a}},[e._v(e._s(t))])}),1)],1)],1)],1)],1)],1),r("a-col",{attrs:{span:12}},[r("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"所属项目"}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["project",{rules:[{required:!0,message:"请选择所属项目"}]}],expression:"[\n                `project`,\n                {\n                  rules: [{\n                    required: true,\n                    message: '请选择所属项目',\n                  }],\n                }\n              ]"}],attrs:{showSearch:"",allowClear:"",filterOption:e.filterOption,placeholder:""},scopedSlots:e._u([{key:"dropdownRender",fn:function(t){return r("div",{},[r("div",{staticStyle:{padding:"8px",cursor:"pointer",position:"relative"},on:{mousedown:function(t){return e.$refs.modal.add(1)}}},[r("a-icon",{attrs:{type:"plus"}}),e._v(" 添加新项目\n                ")],1),r("a-divider",{staticStyle:{margin:"4px 0"}}),r("v-nodes",{attrs:{vnodes:t}})],1)}}])},e._l(e.projectList,function(t){return r("a-select-option",{key:t.id,attrs:{value:t.name}},[e._v(e._s(t.name))])}),1)],1)],1),r("a-col",{attrs:{span:12}},[r("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"所属模块"}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["model"],expression:"[\n                `model`\n              ]"}],attrs:{showSearch:"",filterOption:e.filterOption,placeholder:""},scopedSlots:e._u([{key:"dropdownRender",fn:function(t){return r("div",{},[r("div",{staticStyle:{padding:"8px",cursor:"pointer",position:"relative"},on:{mousedown:function(t){return e.$refs.modal.add(2)}}},[r("a-icon",{attrs:{type:"plus"}}),e._v(" 添加新模块\n                ")],1),r("a-divider",{staticStyle:{margin:"4px 0"}}),r("v-nodes",{attrs:{vnodes:t}})],1)}}])},e._l(e.modelList,function(t){return r("a-select-option",{key:t.id,attrs:{value:t.name}},[e._v(e._s(t.name))])}),1)],1)],1),r("a-col",{attrs:{span:12}},[r("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"影响版本"}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["edition",{rules:[{required:!0,message:"请选择影响版本"}]}],expression:"[\n                `edition`,\n                {\n                  rules: [{\n                    required: true,\n                    message: '请选择影响版本',\n                  }],\n                }\n              ]"}],attrs:{showSearch:"",filterOption:e.filterOption,placeholder:""},scopedSlots:e._u([{key:"dropdownRender",fn:function(t){return r("div",{},[r("div",{staticStyle:{padding:"8px",cursor:"pointer",position:"relative"},on:{mousedown:function(t){return e.$refs.modal.add(3)}}},[r("a-icon",{attrs:{type:"plus"}}),e._v(" 添加新版本\n                ")],1),r("a-divider",{staticStyle:{margin:"4px 0"}}),r("v-nodes",{attrs:{vnodes:t}})],1)}}])},e._l(e.editionList,function(t){return r("a-select-option",{key:t.id,attrs:{value:t.name}},[e._v(e._s(t.name))])}),1)],1)],1),r("a-col",{attrs:{span:12}},[r("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"bug类型"}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["type",{rules:[{required:!0,message:"请选择bug类型"}]}],expression:"[\n                `type`,\n                {\n                  rules: [{\n                    required: true,\n                    message: '请选择bug类型',\n                  }],\n                }\n              ]"}],attrs:{showSearch:"",filterOption:e.filterOption,placeholder:""}},e._l(e.BUG_VARIABLES.type,function(t){return r("a-select-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}),1)],1)],1),r("a-col",{attrs:{span:12}},[r("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"当前指派"}},[r("FormChooseUser",{directives:[{name:"decorator",rawName:"v-decorator",value:["leading_id",{rules:[{required:!0,message:"请选择要指派的用户"}]}],expression:"[\n                `leading_id`,\n                {\n                  rules: [{\n                    required: true,\n                    message: '请选择要指派的用户',\n                  }],\n                }\n              ]"}],attrs:{title:"当前指派","is-single":!0,placeholder:""}})],1)],1),r("a-col",{attrs:{span:12}},[r("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"抄送给"}},[r("FormChooseUser",{directives:[{name:"decorator",rawName:"v-decorator",value:["sendMails"],expression:"[\n                `sendMails`\n              ]"}],attrs:{title:"抄送给","is-single":!1,placeholder:""}})],1)],1),r("a-col",{attrs:{span:12}},[r("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"开始日期"}},[r("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["start_time",{rules:[{required:!0,message:"请选择开始日期"}]}],expression:"[\n                `start_time`,\n                {\n                  rules: [{\n                    required: true,\n                    message: '请选择开始日期',\n                  }],\n                }\n              ]"}],staticStyle:{width:"100%"},attrs:{placeholder:""}})],1)],1),r("a-col",{attrs:{span:12}},[r("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"截止日期"}},[r("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["settling_time",{rules:[{required:!0,message:"请选择截止日期"}]}],expression:"[\n                `settling_time`,\n                {\n                  rules: [{\n                    required: true,\n                    message: '请选择截止日期',\n                  }],\n                }\n              ]"}],staticStyle:{width:"100%"},attrs:{placeholder:""}})],1)],1),r("a-col",{attrs:{span:12}},[r("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"硬件平台"}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["hardware_platform",{initialValue:"all"}],expression:"[\n                `hardware_platform`,\n                {\n                  initialValue: 'all'\n                }\n              ]"}],attrs:{showSearch:"",filterOption:e.filterOption,placeholder:""}},e._l(e.BUG_VARIABLES.hardware_platform,function(t){return r("a-select-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}),1)],1)],1),r("a-col",{attrs:{span:12}},[r("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"操作系统"}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["operating_system",{initialValue:"all"}],expression:"[\n                `operating_system`,\n                {\n                  initialValue: 'all'\n                }\n              ]"}],attrs:{showSearch:"",filterOption:e.filterOption,placeholder:""}},e._l(e.BUG_VARIABLES.operating_system,function(t){return r("a-select-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}),1)],1)],1),r("a-col",{attrs:{span:12}},[r("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"浏览器"}},[r("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["browser",{initialValue:"全部"}],expression:"[\n                `browser`,\n                {\n                  initialValue: '全部'\n                }\n              ]"}],attrs:{showSearch:"",filterOption:e.filterOption,placeholder:""}},e._l(e.BUG_VARIABLES.browser,function(t){return r("a-select-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}),1)],1)],1),r("a-col",{attrs:{span:24}},[r("a-form-item",{attrs:{label:"描述"}},[r("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["describe"],expression:"[\n                `describe`\n              ]"}],attrs:{autosize:{minRows:6,maxRows:6},placeholder:""}})],1)],1),r("a-col",{attrs:{span:24}},[r("a-form-item",{attrs:{label:"附件"}},[r("div",{staticStyle:{width:"300px"}},[r("a-upload",{directives:[{name:"decorator",rawName:"v-decorator",value:["annex",{valuePropName:"fileList",getValueFromEvent:e.normFile}],expression:"['annex', {\n                valuePropName: 'fileList',\n                getValueFromEvent: normFile,\n              }]"}],attrs:{name:"file",extra:"文件最大限制10M","list-type":"picture",action:"/api/upload"}},[r("a-button",[r("a-icon",{attrs:{type:"upload"}}),e._v(" 选择文件\n                ")],1)],1)],1)])],1),r("a-col",{staticStyle:{"text-align":"center"},attrs:{span:24}},[r("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary","html-type":"submit",loading:e.loading}},[e._v("\n            保存\n          ")]),r("a-button",{on:{click:function(t){return e.$router.go(-1)}}},[e._v("\n            取消\n          ")])],1)],1)],1)],1),r("type-modal",{ref:"modal",on:{ok:e.onAddedType}})],1)},n=[],i=r("a745"),o=r.n(i),s=(r("a481"),r("795b")),l=r.n(s),c=(r("ac6a"),r("5df3"),r("d9cd")),u=r("62f6"),d=r("62c7"),p=r("365c"),f=r("88bc"),m=r.n(f),v={components:{TypeModal:u["a"],FormChooseUser:d["a"],VNodes:{functional:!0,render:function(e,t){return t.props.vnodes}}},data:function(){return{labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},mdl:{},BUG_VARIABLES:c["a"],projectList:[],modelList:[],editionList:[],loading:!1,leading:[],sendMails:[],modalType:1,form:this.$form.createForm(this)}},created:function(){var e=this;l.a.all([1,2,3].map(function(e){return p["default"].system.getSystemClassfication(e)})).then(function(t){e.projectList=t[0],e.modelList=t[1],e.editionList=t[2]})},mounted:function(){this.getDetail()},methods:{getDetail:function(){var e=this;p["default"].bug.detail(this.$route.params.id).then(function(t){e.mdl=t.data,e.form.setFieldsValue(m()(e.mdl,"title","severity","priority","project","model","edition","type","start_time"))})},handleSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields(function(e,r){if(!e){var a=t.reformatData(r);t.loading=!0,p["default"].bug.save(a).then(function(e){t.$message.success("保存成功"),t.loading=!1,t.$router.replace("/bug/dashboard")}).catch(function(){t.loading=!1})}})},reformatData:function(e){return e.settling_time=e.settling_time.toDate(),e.leading_id=e.leading_id[0].id,e.sendMails&&(e.sendMails=e.sendMails.map(function(e){return e.id}).join(",")),e.annex&&(e.annex=e.annex[0].response.data),e},normFile:function(e){return console.log("Upload event:",e),o()(e)?e:e&&e.fileList},filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},onAddedType:function(e,t){var r=this;p["default"].system.getSystemClassfication(e).then(function(a){var n={1:"projectList",2:"modelList",3:"editionList"};r[n[e]]=a;var i=n[e].replace(/List/,""),o={};o[i]=t,r.form.setFieldsValue(o)})},onChoosedUers:function(e){this.leading=e},onChoosedSendMails:function(e){this.sendMails=e},deleteUser:function(e,t){this[e].splice(t,1)},onDeleteLeading:function(){}}},h=v,g=(r("b0a4"),r("2877")),b=Object(g["a"])(h,a,n,!1,null,null,null);t["default"]=b.exports},a34b:function(e,t,r){"use strict";var a=r("5014"),n=r.n(a);n.a},b0a4:function(e,t,r){"use strict";var a=r("bce9"),n=r.n(a);n.a},bce9:function(e,t,r){},c8bb:function(e,t,r){e.exports=r("54a1")}}]);