(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7e00086c"],{"00d8":function(e,t,n){},"02e3":function(e,t,n){"use strict";var i=n("40d3"),a=n.n(i);a.a},"24d7":function(e,t,n){},"40d3":function(e,t,n){},5933:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a-card",[n("a-form",{staticClass:"ant-advanced-search-form",attrs:{form:e.form},on:{submit:e.handleSubmit}},[n("a-row",{attrs:{gutter:24}},[n("a-col",{attrs:{span:24}},[n("a-form-item",{attrs:{label:"项目标题"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入项目标题"}]}],expression:"[\n                `name`,\n                {\n                  rules: [{\n                    required: true,\n                    message: '请输入项目标题',\n                  }],\n                }\n              ]"}],attrs:{disabled:e.isDetail,placeholder:""}})],1)],1),n("a-col",{attrs:{span:24}},[n("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"其他"}},[n("tab-other",{ref:"tab",attrs:{value:e.mdl,isDetail:e.isDetail}})],1)],1),n("a-col",{staticStyle:{"text-align":"center"},attrs:{span:24}},[e.isDetail?e._e():n("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary","html-type":"submit",loading:e.loading}},[e._v("保存")]),n("a-button",{on:{click:function(t){return e.$router.go(-1)}}},[e._v(e._s(e.isDetail?"返回":"取消"))])],1)],1)],1)],1),n("type-modal",{ref:"modal",on:{ok:e.onAddedType}})],1)},a=[],s=(n("a481"),n("cebc")),r=(n("7f7f"),n("d9cd")),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-modal",{staticStyle:{top:"20px"},attrs:{title:"新增"+e.typeText,width:800},on:{ok:e.handleOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("a-form",{attrs:{form:e.form,id:"userForm"}},[n("a-form-item",{attrs:{label:e.typeText+"名称",hasFeedback:""}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入"+e.typeText+"名称"}]}],expression:"[\n          'name',\n          {rules: [{ required: true, message: `请输入${typeText}名称` }]}\n        ]"}],attrs:{placeholder:""}})],1)],1)],1)},l=[],c=n("365c"),u={data:function(){return{visible:!1,type:1,form:this.$form.createForm(this)}},computed:{typeText:function(){var e="";switch(this.type){case 1:e="项目";break;case 2:e="模块";break;case 3:e="版本";break}return e}},methods:{add:function(e){var t=this;this.visible=!0,this.type=e,this.$nextTick(function(){t.form.resetFields()})},close:function(){this.$emit("close"),this.visible=!1},handleOk:function(){var e=this;this.form.validateFields(function(t,n){t||(e.confirmLoading=!0,c["default"].system.addSystemClassfication(e.type,n.name).then(function(t){e.$message.success("保存成功"),e.$emit("ok",e.type,n.name)}).catch(function(){}).finally(function(){e.confirmLoading=!1,e.close()}))})}}},d=u,f=n("2877"),h=Object(f["a"])(d,o,l,!1,null,null,null),p=h.exports,m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"choose-user-input"},[n("div",{staticClass:"choose-user-tags"},e._l(e.tags,function(t,i){return n("a-tag",{key:t.account,attrs:{closable:""},on:{close:function(t){return e.deleteTag(i)}}},[e._v(e._s(t.name))])}),1),n("a-button",{attrs:{type:"primary"},on:{click:function(t){e.visible=!0}}},[e._v("选择用户")]),n("a-modal",{staticStyle:{top:"20px"},attrs:{title:e.title,width:600},on:{ok:e.handleOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[n("a-transfer",{attrs:{dataSource:e.userList,showSearch:"",filterOption:e.filterOption,targetKeys:e.targetKeys,render:e.renderItem},on:{change:e.handleChange,selectChange:e.handleSelectChange}})],1)])],1)},g=[],v=(n("6762"),n("2fdb"),n("75fc")),y={props:{title:String,value:{type:Array,default:function(){return[]}},isSingle:{type:Boolean,default:function(){return!0}}},data:function(){return{userList:[],targetKeys:[],visible:!1,tags:[]}},watch:{value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.targetKeys=e},targetKeys:function(e,t){this.isSingle&&e.length>1&&(this.$message.error("只能指派一个用户"),e.pop())}},created:function(){this.getUsers()},methods:{deleteTag:function(e){this.tags.splice(e,1),this.triggerChange(this.tags)},handleChange:function(e,t,n){this.targetKeys=e},handleSelectChange:function(e,t){this.selectedKeys=[].concat(Object(v["a"])(e),Object(v["a"])(t))},getUsers:function(e){var t=this;c["default"].user.list({pageNo:1,pageSize:-1,keyword:e}).then(function(e){t.userList=e.result.data.map(function(e){return e.key=e.id,e.title=e.name,e.description=e.position,e.chosen=!1,e})})},show:function(e){this.title=e,this.visible=!0},renderItem:function(e){var t=this.$createElement,n=t("span",{class:"custom-item"},[e.name]);return{label:n,value:e.name}},close:function(){this.visible=!1},handleOk:function(){var e=this,t=this.userList.filter(function(t){return e.targetKeys.includes(t.id)});this.tags=t,this.close(),this.triggerChange(t)},filterOption:function(e,t){return t.name.indexOf(e)>-1},triggerChange:function(e){this.$emit("change",e)}}},b=y,S=(n("cb72"),Object(f["a"])(b,m,g,!1,null,null,null)),k=S.exports,w=n("57cb"),x=n("88bc"),C=n.n(x),L=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card-container"},[n("a-tabs",{attrs:{type:"card"}},[n("a-tab-pane",{key:"1",attrs:{tab:"模块"}},[n("div",{staticStyle:{"text-align":"right","margin-bottom":"10px"}},[e.isDetail?e._e():n("a-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handleAdd(e.modelList.length)}}},[e._v("添加模块")])],1),n("a-table",{ref:"table",staticStyle:{"overflow-x":"hidden"},attrs:{bordered:"",pagination:!1,size:"small",rowKey:"id",columns:e.modelColumns,dataSource:e.modelList},scopedSlots:e._u([{key:"name",fn:function(t,i){return n("div",{},[i.editable?n("a-input",{staticStyle:{width:"200px"},attrs:{disabled:e.isDetail},model:{value:i.name,callback:function(t){e.$set(i,"name",t)},expression:"record.name"}}):n("span",{staticStyle:{display:"inline-block",width:"200px"}},[e._v(e._s(i.name))])],1)}},{key:"leadingId",fn:function(t,i){return n("div",{},[n("a-select",{staticStyle:{width:"150px"},attrs:{showSearch:"",placeholder:"选择用户",disabled:e.isDetail,filterOption:e.filterOptionLeading},model:{value:i.leadingId,callback:function(t){e.$set(i,"leadingId",t)},expression:"record.leadingId"}},e._l(e.userList,function(t){return n("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1)],1)}},{key:"action",fn:function(t,i){return n("span",{},[e.isDetail?e._e():n("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.handleDeleteModel(i)}}},[e._v("删除")])])}}])})],1),n("a-tab-pane",{key:"2",attrs:{tab:"版本"}},[e._l(e.versionList,function(t){return[n("a-tag",{key:t,attrs:{closable:!e.isDetail,afterClose:function(){return e.handleClose(t)}}},[e._v("\n          "+e._s(t)+"\n        ")])]}),e.inputVisible?n("a-input",{ref:"input",style:{width:"78px"},attrs:{type:"text",size:"small",value:e.inputValue},on:{change:e.handleInputChange,blur:e.handleInputConfirm,keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}}}):n("a-tag",{directives:[{name:"show",rawName:"v-show",value:!e.isDetail,expression:"!isDetail"}],staticStyle:{background:"#fff",borderStyle:"dashed"},on:{click:e.showInput}},[n("a-icon",{attrs:{type:"plus"}}),e._v(" 添加版本\n      ")],1)],2),n("a-tab-pane",{key:"3",attrs:{tab:"抄送"}},[n("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[n("a-transfer",{attrs:{dataSource:e.userList,showSearch:"",disabled:e.isDetail,titles:["用户列表","已选中"],filterOption:e.filterOption,targetKeys:e.sendMailUsers,render:e.renderItem},on:{change:e.handleChange}})],1)])],1)],1)},_=[],O=n("5176"),I=n.n(O),$=(n("20d6"),n("ab09")),U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[n("a-transfer",{attrs:{dataSource:e.userList,showSearch:"",filterOption:e.filterOption,targetKeys:e.targetKeys,render:e.renderItem},on:{change:e.handleChange,selectChange:e.handleSelectChange}})],1)},D=[],j={props:{value:{type:Array,default:function(){return[]}},isSingle:{type:Boolean,default:function(){return!0}}},data:function(){return{userList:[],targetKeys:[],visible:!1,title:""}},watch:{value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.targetKeys=e},targetKeys:function(e,t){this.isSingle&&e.length>1&&(this.$message.error("只能指派一个用户"),e.pop())}},created:function(){this.getUsers()},methods:{getUsers:function(e){var t=this;c["default"].user.list({pageNo:1,pageSize:-1,keyword:e}).then(function(e){t.userList=e.result.data.map(function(e){return e.key=e.id,e.title=e.name,e.description=e.position,e.chosen=!1,e})})},show:function(e){this.title=e,this.visible=!0},handleChange:function(e,t,n){this.targetKeys=e},handleSelectChange:function(e,t){this.selectedKeys=[].concat(Object(v["a"])(e),Object(v["a"])(t))},renderItem:function(e){var t=this.$createElement,n=t("span",{class:"custom-item"},[e.name]);return{label:n,value:e.name}},close:function(){this.visible=!1},handleOk:function(){var e=this,t=this.userList.filter(function(t){return e.targetKeys.includes(t.id)});this.close(),this.$emit("ok",t)},filterOption:function(e,t){return t.name.indexOf(e)>-1},triggerChange:function(e){this.$emit("change",I()({},this.$data,e))}}},K=j,T=(n("02e3"),Object(f["a"])(K,U,D,!1,null,null,null)),V=T.exports,B={props:{value:{type:Object,default:function(){return{modelBeans:[],senderBeans:[],versionBeans:[]}}},isDetail:Boolean},components:{STable:$["a"],ChooseUser:V},data:function(){return{modelColumns:[{title:"模块名称",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"负责人",dataIndex:"leadingId",scopedSlots:{customRender:"leadingId"}},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],versionColumns:[{title:"版本名称",dataIndex:"name"},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],newModel:{name:"",leadingId:""},userList:[],modelList:[],inputVisible:!1,inputValue:"",versionList:[],sendMailUsers:[],selectedKeys:[]}},watch:{value:function(e){this.modelList=e.modelBeans,this.versionList=e.versionBeans,this.sendMailUsers=e.senderBeans.map(function(e){return e.id})}},created:function(){this.getUsers()},methods:{handleAdd:function(e){this.modelList.push({id:e,editable:!0,name:"",leadingId:""})},getUsers:function(e){var t=this;c["default"].user.list({pageNo:1,pageSize:-1,keyword:e,status:2}).then(function(e){t.userList=e.result.data.map(function(e){return e.key=e.id,e.title=e.name,e.description=e.position,e.chosen=!1,e})})},filterOptionLeading:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},filterOption:function(e,t){return t.name.toLowerCase().indexOf(e.toLowerCase())>=0},getData:function(){var e=this.modelList,t=this.versionList,n=this.sendMailUsers,i=n.map(function(e){return{id:e}});return{modelBeans:e,versionBeans:t,senderBeans:i}},handleDeleteModel:function(e){var t=this.modelList.findIndex(function(t){return t.id?t.id===e.id:t.leadingId===e.leadingId});this.$delete(this.modelList,t)},handleClose:function(e){var t=this.versionList.filter(function(t){return t!==e});this.versionList=t},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick(function(){e.$refs.input.focus()})},handleInputChange:function(e){this.inputValue=e.target.value},handleInputConfirm:function(){var e=this.inputValue,t=this.versionList;e&&-1===t.indexOf(e)&&(t=[].concat(Object(v["a"])(t),[e])),console.log(t),I()(this,{versionList:t,inputVisible:!1,inputValue:""})},handleChange:function(e,t,n){this.sendMailUsers=e},renderItem:function(e){var t=this.$createElement,n=t("span",{class:"custom-item"},[e.name]);return{label:n,value:e.name}}}},E=B,A=(n("8307"),Object(f["a"])(E,L,_,!1,null,null,null)),M=A.exports,P={components:{TypeModal:p,FormChooseUser:k,Ueditor:w["a"],TabOther:M,VNodes:{functional:!0,render:function(e,t){return t.props.vnodes}}},data:function(){return{id:this.$route.params.id,uploadUrl:"http://".concat(window.localStorage.getItem("VUE_APP_HOST")?window.localStorage.getItem("VUE_APP_HOST"):"61.144.170.35",":").concat(window.localStorage.getItem("VUE_APP_PORT")?window.localStorage.getItem("VUE_APP_PORT"):"83","/upload"),labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},BUG_VARIABLES:r["a"],projectList:[],userList:[],modelList:[],mdl:{},editionList:[],loading:!1,leading:[],sendMailUsers:[],modalType:1,isDetail:"ProjectDetail"===this.$route.name,form:this.$form.createForm(this)}},created:function(){this.id&&this.getDetail()},methods:{getDetail:function(){var e=this;c["default"].project.detail(this.id).then(function(t){e.mdl=t.data,e.form.setFieldsValue(C()(e.mdl,"name"))})},fetchUser:function(e){var t=this;this.fetching=!0,c["default"].user.list({pageNo:1,pageSize:-1,keyword:e}).then(function(e){t.userList=e.result.data.map(function(e){return e.key=e.id,e.title=e.name,e.description=e.position,e.chosen=!1,e}),t.fetching=!1})},handleSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields(function(e,n){if(!e){var i=t.$refs.tab.getData(),a=Object(s["a"])({id:t.id},n,i);t.loading=!0;var r=t.id?"update":"save";c["default"].project[r](a).then(function(e){t.$message.success("保存成功"),t.loading=!1,t.$router.replace("/project/dashboard")}).catch(function(){t.loading=!1})}})},onAddedType:function(e,t){var n=this;c["default"].system.getSystemClassfication(e).then(function(i){var a={1:"projectList",2:"modelList",3:"editionList"};n[a[e]]=i;var s=a[e].replace(/List/,""),r={};r[s]=t,n.form.setFieldsValue(r)})},onChoosedUers:function(e){this.leading=e},onChoosedSendMails:function(e){this.sendMailUsers=e},deleteUser:function(e,t){this[e].splice(t,1)},onDeleteLeading:function(){}}},F=P,N=(n("fbe6"),Object(f["a"])(F,i,a,!1,null,null,null));t["default"]=N.exports},8307:function(e,t,n){"use strict";var i=n("00d8"),a=n.n(i);a.a},cb72:function(e,t,n){"use strict";var i=n("24d7"),a=n.n(i);a.a},d51a:function(e,t,n){},fbe6:function(e,t,n){"use strict";var i=n("d51a"),a=n.n(i);a.a}}]);