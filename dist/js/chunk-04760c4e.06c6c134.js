(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-04760c4e"],{5014:function(e,t,n){},"569f":function(e,t,n){"use strict";var a=n("906d"),r=n.n(a);r.a},"6af3":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a-spin",{attrs:{tip:"加载中...",spinning:e.spinning}},[n("a-card",{attrs:{title:"提Bug"}},[n("a-form",{staticClass:"ant-advanced-search-form",attrs:{form:e.form},on:{submit:e.handleSubmit}},[n("a-row",{attrs:{gutter:24}},[n("a-col",{attrs:{span:24}},[n("a-row",[n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{label:"Bug标题"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,message:"请输入Bug标题"}]}],expression:"[\n                      `title`,\n                      {\n                        rules: [{\n                          required: true,\n                          message: '请输入Bug标题',\n                        }],\n                      }\n                    ]"}],staticStyle:{"border-right":"none","border-radius":"4px 0 0 4px"},attrs:{placeholder:""}})],1)],1),n("a-col",{attrs:{span:6}},[n("a-form-item",[n("a-input-group",{staticClass:"inline-select-label",attrs:{compact:""}},[n("a-input",{staticStyle:{width:"40%","border-radius":"0","text-align":"center",color:"#333"},attrs:{defaultValue:"严重程度",disabled:""}}),n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["severity",{rules:[{required:!0,message:"请选择严重程度"}]}],expression:"[\n                        `severity`,\n                        {\n                          rules: [{\n                            required: true,\n                            message: '请选择严重程度',\n                          }],\n                        }\n                      ]"}],staticClass:"compact-select",staticStyle:{width:"60%"}},e._l(e.BUG_VARIABLES.severity,function(t,a){return n("a-select-option",{key:t,attrs:{value:a}},[e._v(e._s(t))])}),1)],1)],1)],1),n("a-col",{attrs:{span:6}},[n("a-form-item",[n("a-input-group",{staticClass:"inline-select-label",attrs:{compact:""}},[n("a-input",{staticStyle:{width:"40%","border-radius":"0","text-align":"center",color:"#333"},attrs:{defaultValue:"优先级",disabled:""}}),n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["priority",{rules:[{required:!0,message:"请选择优先级"}]}],expression:"[\n                        `priority`,\n                        {\n                          rules: [{\n                            required: true,\n                            message: '请选择优先级',\n                          }],\n                        }\n                      ]"}],staticStyle:{width:"60%","border-left":"none","border-radius":"0"}},e._l(e.BUG_VARIABLES.priority,function(t,a){return n("a-select-option",{key:a,attrs:{value:a}},[e._v(e._s(t))])}),1)],1)],1)],1)],1)],1),n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"所属项目"}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["project",{rules:[{required:!0,message:"请选择所属项目"}]}],expression:"[\n                  `project`,\n                  {\n                    rules: [{\n                      required: true,\n                      message: '请选择所属项目',\n                    }],\n                  }\n                ]"}],attrs:{showSearch:"",allowClear:"",filterOption:e.filterOption,placeholder:""},on:{change:e.handleChangeProject}},e._l(e.projectList,function(t){return n("a-select-option",{key:t.id,attrs:{value:t.name}},[e._v(e._s(t.name))])}),1)],1)],1),n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"所属模块"}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["model",{rules:[{required:!0,message:"请选择所属模块"}]}],expression:"[\n                  `model`,\n                  {\n                    rules: [{\n                      required: true,\n                      message: '请选择所属模块',\n                    }],\n                  }\n                ]"}],attrs:{showSearch:"",filterOption:e.filterOption,placeholder:""},on:{change:e.handleChangeModel},scopedSlots:e._u([{key:"dropdownRender",fn:function(e){return n("div",{},[n("v-nodes",{attrs:{vnodes:e}})],1)}}])},e._l(e.modelList,function(t){return n("a-select-option",{key:t.id,attrs:{value:t.name}},[e._v(e._s(t.name))])}),1)],1)],1),n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"bug影响版本"}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["edition",{rules:[{required:!0,message:"请选择影响版本"}]}],expression:"[\n                  `edition`,\n                  {\n                    rules: [{\n                      required: true,\n                      message: '请选择影响版本',\n                    }],\n                  }\n                ]"}],attrs:{showSearch:"",filterOption:e.filterOption,placeholder:""},scopedSlots:e._u([{key:"dropdownRender",fn:function(e){return n("div",{},[n("v-nodes",{attrs:{vnodes:e}})],1)}}])},e._l(e.editionList,function(t){return n("a-select-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}),1)],1)],1),n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"bug类型"}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["type"],expression:"[\n                  `type`\n                ]"}],attrs:{showSearch:"",filterOption:e.filterOption,placeholder:""}},e._l(e.BUG_VARIABLES.type,function(t){return n("a-select-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}),1)],1)],1),n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"Bug开始时间"}},[n("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["start_time",{initialValue:e.moment(new Date),rules:[{required:!0,message:"请选择开始日期"}]}],expression:"[\n                  `start_time`,\n                  {\n                    initialValue: moment(new Date()),\n                    rules: [{\n                      required: true,\n                      message: '请选择开始日期',\n                    }],\n                  }\n                ]"}],staticStyle:{width:"100%"},attrs:{showTime:{format:"HH"},format:"YYYY-MM-DD HH:mm",placeholder:""}})],1)],1),n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"bug解决日期"}},[n("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["settling_time",{rules:[{required:!0,message:"请选择截止日期"}]}],expression:"[\n                  `settling_time`,\n                  {\n                    rules: [{\n                      required: true,\n                      message: '请选择截止日期',\n                    }],\n                  }\n                ]"}],staticStyle:{width:"100%"},attrs:{showTime:{format:"HH"},format:"YYYY-MM-DD HH",placeholder:""}})],1)],1),n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"当前指派"}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["leading_id",{rules:[{required:!0,message:"请选择要指派的用户"}]}],expression:"[\n                  `leading_id`,\n                  {\n                    rules: [{\n                      required: true,\n                      message: '请选择要指派的用户',\n                    }],\n                  }\n                ]"}],staticStyle:{width:"100%"},attrs:{showSearch:"",disabled:!0,placeholder:"",filterOption:e.filterOption,notFoundContent:e.fetching?void 0:null}},[e.fetching?n("a-spin",{attrs:{slot:"notFoundContent",size:"small"},slot:"notFoundContent"}):e._e(),e._l(e.userList,function(t){return n("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})],2)],1)],1),n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"抄送给"}},[n("div",{staticClass:"senders-box"},[e._l(e.fixedSenders,function(t){return n("a-tag",{key:t.id,attrs:{closable:!1}},[e._v(e._s(t.name))])}),n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["sendMailUsers"],expression:"[\n                    `sendMailUsers`\n                  ]"}],staticStyle:{width:"100%"},attrs:{showSearch:"",id:"sender-select",mode:"multiple",placeholder:"选择其他需要抄送的用户",filterOption:e.filterOption,notFoundContent:e.fetching?void 0:null}},[e.fetching?n("a-spin",{attrs:{slot:"找不到用户",size:"small"},slot:"找不到用户"}):e._e(),e._l(e.userList,function(t){return n("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})],2)],2)])],1),n("a-col",{attrs:{span:24}},[n("a-form-item",{attrs:{label:"Bug问题描述"}},[n("Ueditor",{directives:[{name:"decorator",rawName:"v-decorator",value:["describe",{rules:[{required:!0,message:"请添加Bug问题描述"}]}],expression:"[\n                  `describe`,\n                  {\n                    rules: [{\n                      required: true,\n                      message: '请添加Bug问题描述',\n                    }],\n                  }\n                ]"}]})],1)],1),n("a-col",{attrs:{span:24}},[n("a-form-item",{attrs:{label:"附件"}},[n("div",{staticStyle:{width:"300px"}},[n("a-upload",{directives:[{name:"decorator",rawName:"v-decorator",value:["annexs",{valuePropName:"fileList",getValueFromEvent:e.normFile}],expression:"[\n                    'annexs', {\n                      valuePropName: 'fileList',\n                      getValueFromEvent: normFile,\n                    }\n                  ]"}],attrs:{withCredentials:!0,name:"file",extra:"文件最大限制10M","list-type":"text",beforeUpload:e.beforeUpload,action:e.uploadUrl},on:{change:e.handleChange}},[n("a-button",[n("a-icon",{attrs:{type:"upload"}}),e._v("选择文件\n                  ")],1)],1),n("div",[e._v("\n                  附件文件类型：\n                  "),n("br"),e._v("文档：doc docx xls xlsx ppt pptx pdf csv\n                  "),n("br"),e._v("图片：bmp jpg png gif\n                  "),n("br"),e._v("视频：3GP MP4 AVI\n                ")])],1)])],1),n("a-col",{staticStyle:{"text-align":"center"},attrs:{span:24}},[n("a-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary","html-type":"submit",loading:e.loading}},[e._v("保存")]),n("a-button",{on:{click:function(t){return e.$router.go(-1)}}},[e._v("取消")])],1)],1)],1)],1)],1),n("type-modal",{ref:"modal",on:{ok:e.onAddedType}})],1)},r=[],i=n("a745"),s=n.n(i),o=(n("a481"),n("96cf"),n("3b8d")),l=(n("7514"),n("6762"),n("7f7f"),n("28a5"),n("d9cd")),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-modal",{staticStyle:{top:"20px"},attrs:{title:"新增"+e.typeText,width:800},on:{ok:e.handleOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("a-form",{attrs:{form:e.form,id:"userForm"}},[n("a-form-item",{attrs:{label:e.typeText+"名称",hasFeedback:""}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入"+e.typeText+"名称"}]}],expression:"[\n          'name',\n          {rules: [{ required: true, message: `请输入${typeText}名称` }]}\n        ]"}],attrs:{placeholder:""}})],1)],1)],1)},d=[],u=n("365c"),p={data:function(){return{visible:!1,type:1,form:this.$form.createForm(this)}},computed:{typeText:function(){var e="";switch(this.type){case 1:e="项目";break;case 2:e="模块";break;case 3:e="版本";break}return e}},methods:{add:function(e){var t=this;this.visible=!0,this.type=e,this.$nextTick(function(){t.form.resetFields()})},close:function(){this.$emit("close"),this.visible=!1},handleOk:function(){var e=this;this.form.validateFields(function(t,n){t||(e.confirmLoading=!0,u["default"].system.addSystemClassfication(e.type,n.name).then(function(t){e.$message.success("保存成功"),e.$emit("ok",e.type,n.name)}).catch(function(){}).finally(function(){e.confirmLoading=!1,e.close()}))})}}},m=p,f=n("2877"),h=Object(f["a"])(m,c,d,!1,null,null,null),g=h.exports,v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"choose-user-input"},[n("div",{staticClass:"choose-user-tags"},e._l(e.tags,function(t,a){return n("a-tag",{key:t.account,attrs:{closable:""},on:{close:function(t){return e.deleteTag(a)}}},[e._v(e._s(t.name))])}),1),n("a-button",{attrs:{type:"primary"},on:{click:function(t){e.visible=!0}}},[e._v("选择用户")]),n("a-modal",{staticStyle:{top:"20px"},attrs:{title:e.title,width:600},on:{ok:e.handleOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[n("a-transfer",{attrs:{dataSource:e.userList,showSearch:"",filterOption:e.filterOption,targetKeys:e.targetKeys,render:e.renderItem},on:{change:e.handleChange,selectChange:e.handleSelectChange}})],1)])],1)},b=[],w=(n("2fdb"),n("75fc")),x={props:{title:String,value:{type:Array,default:function(){return[]}},isSingle:{type:Boolean,default:function(){return!0}}},data:function(){return{userList:[],targetKeys:[],visible:!1,tags:[]}},watch:{value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.targetKeys=e},targetKeys:function(e,t){this.isSingle&&e.length>1&&(this.$message.error("只能指派一个用户"),e.pop())}},created:function(){this.getUsers()},methods:{deleteTag:function(e){this.tags.splice(e,1),this.triggerChange(this.tags)},handleChange:function(e,t,n){this.targetKeys=e},handleSelectChange:function(e,t){this.selectedKeys=[].concat(Object(w["a"])(e),Object(w["a"])(t))},getUsers:function(e){var t=this;u["default"].user.list({pageNo:1,pageSize:-1,keyword:e}).then(function(e){t.userList=e.result.data.map(function(e){return e.key=e.id,e.title=e.name,e.description=e.position,e.chosen=!1,e})})},show:function(e){this.title=e,this.visible=!0},renderItem:function(e){var t=this.$createElement,n=t("span",{class:"custom-item"},[e.name]);return{label:n,value:e.name}},close:function(){this.visible=!1},handleOk:function(){var e=this,t=this.userList.filter(function(t){return e.targetKeys.includes(t.id)});this.tags=t,this.close(),this.triggerChange(t)},filterOption:function(e,t){return t.name.indexOf(e)>-1},triggerChange:function(e){this.$emit("change",e)}}},y=x,_=(n("a34b"),Object(f["a"])(y,v,b,!1,null,null,null)),C=_.exports,S=n("57cb"),k=n("88bc"),L=n.n(k),O=n("c1df"),U=n.n(O),P={components:{TypeModal:g,FormChooseUser:C,Ueditor:S["a"],VNodes:{functional:!0,render:function(e,t){return t.props.vnodes}}},data:function(){return{moment:U.a,spinning:!1,id:this.$route.params.id,uploadUrl:"http://".concat(window.localStorage.getItem("VUE_APP_HOST")?window.localStorage.getItem("VUE_APP_HOST"):"61.144.170.35",":").concat(window.localStorage.getItem("VUE_APP_PORT")?window.localStorage.getItem("VUE_APP_PORT"):"83","/upload"),labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},BUG_VARIABLES:l["a"],fixedSenders:[],fixedLeading:null,projectList:[],userList:[],modelList:[],mdl:{},editionList:[],loading:!1,leading:[],sendMailUsers:[],modalType:1,fetching:!1,form:this.$form.createForm(this),currentProject:{}}},mounted:function(){this.getProjectList();try{this.$route.params.id&&this.getDetail()}catch(e){console.log(e)}this.fetchUser()},methods:{beforeUpload:function(e){var t=["doc","docx","xls","xlsx","ppt","pptx","pdf","csv","bmp","jpg","png","gif","3gp","mp4","avi"],n=e.name.split("."),a=n[n.length-1],r=t.includes(a);return r||this.$notification.error({message:"温馨提示",description:"附件上传限于以下文件类型： \n\n                  文档：doc docx xls xlsx ppt pptx pdf csv\n\n                  图片：bmp jpg png gif\n\n                  视频：3GP MP4 AVI\n"}),r},isValidFile:function(e){var t=["doc","docx","xls","xlsx","ppt","pptx","pdf","csv","bmp","jpg","png","gif","3gp","mp4","avi"],n=e.name.split("."),a=n[n.length-1],r=t.includes(a);return r},handleChange:function(e){var t=e.fileList,n=(e.file,e.event,t.filter(this.isValidFile));console.log(n),this.form.setFieldsValue({annexs:n})},getProjectList:function(){var e=this;u["default"].project.list({pageNo:1,pageSize:-1}).then(function(t){e.projectList=t.result.data})},handleChangeModel:function(e){var t=this.currentProject.modelBeans.find(function(t){return t.name===e});this.form.setFieldsValue({leading_id:t.leadingId})},handleChangeProject:function(e){var t=this.projectList.find(function(t){return t.name===e});this.currentProject=t,this.modelList=t.modelBeans,this.editionList=t.versionBeans;var n=t.senderBeans;this.fixedSenders=n},getDetail:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.spinning=!0,e.prev=1,e.next=4,u["default"].bug.detail(this.id);case 4:t=e.sent,this.mdl=t.data,this.mdl.leading_id=this.mdl.leadingId,this.mdl.start_time=U()(this.mdl.startTime),this.mdl.settling_time=U()(this.mdl.settlingTime),this.mdl.describe=decodeURIComponent(this.mdl.describe),this.fixedSenders=this.mdl.sendMailUsers,this.mdl.annexs=this.mdl.annexs.map(function(e,t){var n=e.split("/"),a=n[n.length-1];return{uid:t,name:a,status:"done",url:e}}),this.form.setFieldsValue(L()(this.mdl,"title","severity","annexs","priority","project","model","edition","type","start_time","describe","settling_time","leading_id")),e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](1),console.log(e.t0);case 18:return e.prev=18,this.spinning=!1,e.finish(18);case 21:case"end":return e.stop()}},e,this,[[1,15,18,21]])}));function t(){return e.apply(this,arguments)}return t}(),fetchUser:function(e){var t=this;this.fetching=!0,u["default"].user.list({pageNo:1,pageSize:-1,keyword:e,status:this.id?2:1}).then(function(e){t.userList=e.result.data.map(function(e){return e.key=e.id,e.title=e.name,e.description=e.position,e.chosen=!1,e}),t.fetching=!1})},handleSubmit:function(e){var t=this;e.preventDefault(),this.form.validateFields(function(e,n){if(!e){var a=t.reformatData(n);t.loading=!0;var r=t.id?"updateBug":"save";u["default"].bug[r](a).then(function(e){t.$message.success("保存成功"),t.loading=!1,t.$router.replace("/bug/dashboard")}).catch(function(){t.loading=!1})}})},reformatData:function(e){if(e.describe=encodeURIComponent(e.describe),!e.settling_time.isBefore(e.start_time))return e.settling_time=e.settling_time.toDate(),e.start_time=e.start_time.toDate(),e.annexs&&e.annexs.length>0&&(e.annexs=e.annexs.map(function(e){return e.hasOwnProperty("response")?"http://".concat(window.localStorage.getItem("VUE_APP_HOST")?window.localStorage.getItem("VUE_APP_HOST"):"61.144.170.35",":").concat(window.localStorage.getItem("VUE_APP_PORT")?window.localStorage.getItem("VUE_APP_PORT"):"83","/download?path=").concat(e.response.data):e})),e.sendMails=this.fixedSenders.length>0?this.fixedSenders.map(function(e){return e.id}).join(","):"",e.sendMailUsers&&(e.sendMails=e.sendMails+","+e.sendMailUsers.join(",")),console.log(e.sendMails),delete e.sendMailUsers,this.id&&(e["id"]=this.id),e["type"]=e["type"]||"",e;this.$message.error("解决日期不能在开始日期之前")},filterValidFile:function(e){var t=["doc","docx","xls","xlsx","ppt","pptx","pdf","csv","bmp","jpg","png","gif","3gp","mp4","avi"];return e.filter(function(e){var n=e.name.split("."),a=n[n.length-1],r=t.includes(a);return r})},normFile:function(e){return s()(e)?this.filterValidFile(e):e&&this.filterValidFile(e.fileList)},filterOption:function(e,t){return t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},onAddedType:function(e,t){var n=this;u["default"].system.getSystemClassfication(e).then(function(a){var r={1:"projectList",2:"modelList",3:"editionList"};n[r[e]]=a;var i=r[e].replace(/List/,""),s={};s[i]=t,n.form.setFieldsValue(s)})},onChoosedUers:function(e){this.leading=e},onChoosedSendMails:function(e){this.sendMailUsers=e},deleteUser:function(e,t){this[e].splice(t,1)},onDeleteLeading:function(){}}},j=P,V=(n("569f"),Object(f["a"])(j,a,r,!1,null,null,null));t["default"]=V.exports},"906d":function(e,t,n){},a34b:function(e,t,n){"use strict";var a=n("5014"),r=n.n(a);r.a}}]);